<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>File Repository</title>
    <style>
      /* Minimal CSS for fast loading */
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      body {
        font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
        line-height: 1.6;
        color: #333;
        background: #f5f5f5;
        padding: 20px;
        max-width: 1000px;
        margin: 0 auto;
      }

      header {
        text-align: center;
        margin-bottom: 30px;
        padding-bottom: 20px;
        border-bottom: 1px solid #ddd;
      }

      h1 {
        color: #2c3e50;
        margin-bottom: 10px;
        font-size: 1.8rem;
      }

      .subtitle {
        color: #666;
        font-size: 0.95rem;
      }

      .container {
        background: white;
        border-radius: 8px;
        padding: 25px;
        box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
      }

      .controls {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 20px;
        flex-wrap: wrap;
        gap: 15px;
      }

      .file-count {
        font-weight: 600;
        color: #3498db;
      }

      #search {
        padding: 8px 12px;
        border: 1px solid #ddd;
        border-radius: 4px;
        width: 250px;
        max-width: 100%;
      }

      .file-list {
        list-style: none;
        min-height: 300px;
      }

      .file-item {
        display: flex;
        align-items: center;
        padding: 12px 15px;
        margin-bottom: 8px;
        background: #f8f9fa;
        border-radius: 6px;
        border-left: 4px solid #3498db;
      }

      .file-item:hover {
        background: #e8f4fc;
      }

      .file-icon {
        font-size: 1.5rem;
        margin-right: 15px;
        min-width: 40px;
        text-align: center;
      }

      .file-info {
        flex-grow: 1;
      }

      .file-name {
        font-weight: 600;
        margin-bottom: 3px;
        word-break: break-word;
      }

      .file-size {
        font-size: 0.85rem;
        color: #666;
      }

      .download-btn {
        background: #2ecc71;
        color: white;
        border: none;
        padding: 8px 16px;
        border-radius: 4px;
        cursor: pointer;
        text-decoration: none;
        display: inline-block;
        font-weight: 500;
        transition: background 0.2s;
      }

      .download-btn:hover {
        background: #27ae60;
      }

      .loading {
        text-align: center;
        padding: 50px 20px;
        color: #666;
      }

      .spinner {
        border: 3px solid #f3f3f3;
        border-top: 3px solid #3498db;
        border-radius: 50%;
        width: 40px;
        height: 40px;
        animation: spin 1s linear infinite;
        margin: 0 auto 15px;
      }

      @keyframes spin {
        0% {
          transform: rotate(0deg);
        }
        100% {
          transform: rotate(360deg);
        }
      }

      .empty {
        text-align: center;
        padding: 50px 20px;
        color: #666;
      }

      footer {
        text-align: center;
        margin-top: 30px;
        padding-top: 20px;
        border-top: 1px solid #ddd;
        color: #777;
        font-size: 0.9rem;
      }

      @media (max-width: 768px) {
        body {
          padding: 10px;
        }

        .container {
          padding: 15px;
        }

        .controls {
          flex-direction: column;
          align-items: stretch;
        }

        #search {
          width: 100%;
        }

        .file-item {
          flex-direction: column;
          align-items: flex-start;
        }

        .download-btn {
          align-self: flex-end;
          margin-top: 10px;
        }
      }
    </style>
  </head>
  <body>
    <header>
      <h1>üìÅFile Repository</h1>
      <p class="subtitle"></p>
    </header>

    <main class="container">
      <div class="controls">
        <h2>
          Available Files
          <span class="file-count" id="fileCount">(0 files)</span>
        </h2>
        <input
          type="text"
          id="search"
          placeholder="Search files..."
          autocomplete="off"
        />
      </div>

      <div id="loading" class="loading">
        <div class="spinner"></div>
        <p>Scanning data folder for files...</p>
      </div>

      <ul id="fileList" class="file-list">
        <!-- Files will be inserted here by JavaScript -->
      </ul>

      <div id="emptyState" class="empty" style="display: none">
        <p>üì≠ No files found in data folder</p>
        <p>Add files to the /data folder and refresh this page</p>
      </div>
    </main>

    <footer>
      <p></p>
      <p></p>
    </footer>

    <script>
      // Configuration
      const DATA_FOLDER = "data"; // Change this if your folder has a different name
      const ENABLE_CACHE = true; // Set to false to always fetch fresh file list
      const CACHE_DURATION = 5 * 60 * 1000; // 5 minutes cache duration

      // File type icons
      const FILE_ICONS = {
        pdf: "üìï",
        doc: "üìÑ",
        docx: "üìÑ",
        xls: "üìä",
        xlsx: "üìä",
        csv: "üìä",
        ppt: "üìë",
        pptx: "üìë",
        zip: "üì¶",
        rar: "üì¶",
        "7z": "üì¶",
        gz: "üì¶",
        tar: "üì¶",
        js: "üíª",
        html: "üíª",
        css: "üíª",
        json: "üíª",
        xml: "üíª",
        txt: "üìù",
        md: "üìù",
        jpg: "üñºÔ∏è",
        jpeg: "üñºÔ∏è",
        png: "üñºÔ∏è",
        gif: "üñºÔ∏è",
        svg: "üñºÔ∏è",
        mp4: "üé¨",
        avi: "üé¨",
        mov: "üé¨",
        mp3: "üéµ",
        wav: "üéµ",
        default: "üìÅ",
      };

      // DOM elements
      const fileList = document.getElementById("fileList");
      const loading = document.getElementById("loading");
      const emptyState = document.getElementById("emptyState");
      const searchInput = document.getElementById("search");
      const fileCount = document.getElementById("fileCount");

      // Main function to load files
      async function loadFiles() {
        try {
          console.log("Loading files from", DATA_FOLDER, "folder...");

          // First, try to fetch files.json if it exists (for manual file listing)
          const files =
            (await fetchFilesFromJson()) || (await scanDataFolder());

          if (files && files.length > 0) {
            displayFiles(files);
            setupSearch(files);
          } else {
            showEmptyState();
          }

          loading.style.display = "none";
        } catch (error) {
          console.error("Error loading files:", error);
          loading.innerHTML = `
                    <p>‚ö†Ô∏è Error loading files</p>
                    <p style="font-size: 0.9rem; margin-top: 10px;">
                        Make sure the <strong>${DATA_FOLDER}</strong> folder exists and contains files.
                        <br>Check browser console for details.
                    </p>
                `;
        }
      }

      // Method 1: Try to fetch from files.json (for manual control)
      async function fetchFilesFromJson() {
        try {
          const response = await fetch(`${DATA_FOLDER}/files.json`);
          if (!response.ok) return null;

          const data = await response.json();
          console.log("Loaded files from files.json:", data.length);
          return data.map((file) => ({
            ...file,
            url: `${DATA_FOLDER}/${encodeURIComponent(file.name)}`,
          }));
        } catch {
          return null;
        }
      }

      // Method 2: Scan the data folder for files
      async function scanDataFolder() {
        console.log("Scanning data folder...");

        // For GitHub Pages, we need a different approach
        // Try to fetch a known file to see if data folder exists
        const testFile = `${DATA_FOLDER}/.test`;

        try {
          // First, try to get files using fetch (works if files are accessible)
          // This method works for static files on most servers
          const files = await getFilesViaFetch();
          if (files.length > 0) return files;

          // If fetch method fails, try alternative method for GitHub Pages
          return await getFilesViaDirectoryIndex();
        } catch (error) {
          console.log("Scan failed, trying alternative methods...");
          return [];
        }
      }

      // Method 2a: Try to fetch files one by one from a predefined list
      async function getFilesViaFetch() {
        const files = [];

        // Try common file extensions
        const commonExtensions = [
          "pdf",
          "doc",
          "docx",
          "xlsx",
          "xls",
          "ppt",
          "pptx",
          "zip",
          "rar",
          "txt",
          "jpg",
          "png",
          "mp4",
          "mp3",
        ];

        // Try to detect files by common names (you can add your own)
        const testFileNames = [
          "document.pdf",
          "data.zip",
          "report.docx",
          "presentation.pptx",
          "notes.txt",
          "image.jpg",
          "video.mp4",
          "audio.mp3",
        ];

        // This method is limited but can work for known files
        for (const name of testFileNames) {
          try {
            const response = await fetch(`${DATA_FOLDER}/${name}`, {
              method: "HEAD",
            });
            if (response.ok) {
              files.push({
                name: name,
                size: await getFileSize(`${DATA_FOLDER}/${name}`),
                url: `${DATA_FOLDER}/${name}`,
              });
            }
          } catch (e) {
            // File doesn't exist or not accessible
          }
        }

        return files;
      }

      // Method 2b: Try to use directory listing (if enabled on server)
      async function getFilesViaDirectoryIndex() {
        try {
          const response = await fetch(`${DATA_FOLDER}/`);
          if (!response.ok) return [];

          const html = await response.text();

          // Parse HTML directory listing (if server provides one)
          const parser = new DOMParser();
          const doc = parser.parseFromString(html, "text/html");
          const links = doc.querySelectorAll("a[href]");

          const files = [];
          for (const link of links) {
            const href = link.getAttribute("href");
            const name = href.split("/").pop();

            // Skip parent directory and current directory links
            if (href === "../" || href === "./" || !name || name.includes("?"))
              continue;

            // Skip files that are likely not regular files
            if (href.endsWith("/")) continue; // Skip subdirectories

            // Try to get file size from link text if available
            const text = link.textContent || "";
            const sizeMatch = text.match(/\((\d+(?:\.\d+)?\s*[KMGT]?B)\)/i);

            files.push({
              name: decodeURIComponent(name),
              size: sizeMatch ? sizeMatch[1] : "Unknown size",
              url: `${DATA_FOLDER}/${encodeURIComponent(name)}`,
            });
          }

          console.log("Found files via directory index:", files.length);
          return files;
        } catch (error) {
          console.log("Directory index not available");
          return [];
        }
      }

      // Get file size by fetching file headers
      async function getFileSize(url) {
        try {
          const response = await fetch(url, { method: "HEAD" });
          if (response.ok) {
            const size = response.headers.get("content-length");
            if (size) {
              return formatFileSize(parseInt(size));
            }
          }
        } catch (e) {
          // Couldn't get file size
        }
        return "Unknown size";
      }

      // Format file size in human-readable format
      function formatFileSize(bytes) {
        if (bytes === 0) return "0 Bytes";
        const k = 1024;
        const sizes = ["Bytes", "KB", "MB", "GB"];
        const i = Math.floor(Math.log(bytes) / Math.log(k));
        return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + " " + sizes[i];
      }

      // Get file icon based on extension
      function getFileIcon(filename) {
        const extension = filename.split(".").pop().toLowerCase();
        return FILE_ICONS[extension] || FILE_ICONS.default;
      }

      // Display files in the list
      function displayFiles(files) {
        fileList.innerHTML = "";

        files.forEach((file) => {
          const li = document.createElement("li");
          li.className = "file-item";

          li.innerHTML = `
                    <div class="file-icon">${getFileIcon(file.name)}</div>
                    <div class="file-info">
                        <div class="file-name">${file.name}</div>
                        <div class="file-size">${file.size}</div>
                    </div>
                    <a href="${file.url}" class="download-btn" download="${
            file.name
          }">
                        Download
                    </a>
                `;

          fileList.appendChild(li);
        });

        fileCount.textContent = `(${files.length} ${
          files.length === 1 ? "file" : "files"
        })`;
      }

      // Set up search functionality
      function setupSearch(files) {
        searchInput.addEventListener("input", function () {
          const searchTerm = this.value.toLowerCase().trim();

          if (!searchTerm) {
            // Show all files if search is empty
            fileList.querySelectorAll(".file-item").forEach((item) => {
              item.style.display = "flex";
            });
            fileCount.textContent = `(${files.length} ${
              files.length === 1 ? "file" : "files"
            })`;
            return;
          }

          // Filter files
          let visibleCount = 0;
          fileList.querySelectorAll(".file-item").forEach((item) => {
            const fileName = item
              .querySelector(".file-name")
              .textContent.toLowerCase();
            if (fileName.includes(searchTerm)) {
              item.style.display = "flex";
              visibleCount++;
            } else {
              item.style.display = "none";
            }
          });

          fileCount.textContent = `(${visibleCount} of ${files.length} ${
            files.length === 1 ? "file" : "files"
          })`;

          // Show empty state if no files match
          if (visibleCount === 0) {
            emptyState.style.display = "block";
            emptyState.innerHTML = `
                        <p>üîç No files matching "${searchTerm}"</p>
                        <p style="font-size: 0.9rem; margin-top: 10px;">Try a different search term</p>
                    `;
          } else {
            emptyState.style.display = "none";
          }
        });
      }

      // Show empty state
      function showEmptyState() {
        fileList.style.display = "none";
        emptyState.style.display = "block";
        fileCount.textContent = "(0 files)";
      }

      // Initialize when page loads
      document.addEventListener("DOMContentLoaded", function () {
        loadFiles();

        // Add refresh button functionality
        searchInput.insertAdjacentHTML(
          "afterend",
          '<button id="refreshBtn" style="margin-left: 10px; padding: 8px 12px; background: #3498db; color: white; border: none; border-radius: 4px; cursor: pointer;">Refresh</button>'
        );

        document
          .getElementById("refreshBtn")
          .addEventListener("click", function () {
            loading.style.display = "block";
            fileList.style.display = "block";
            emptyState.style.display = "none";
            fileList.innerHTML = "";
            searchInput.value = "";
            loadFiles();
          });
      });
    </script>
  </body>
</html>
